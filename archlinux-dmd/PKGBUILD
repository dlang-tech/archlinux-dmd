# Maintainer: Rory McGuire <rjmcguire@gmail.com>
# Contributor: Mihails Strasunse <public@dicebot.lv>
# Contributor: Sven-Hendrik Haase <sh@lutzhaase.com>
# Contributor: Chris Brannon <cmbrannon79@gmail.com>
# Contributor: Andrea Scarpino <andrea@archlinux.org>
# Contributor: Anders Bergh <anders1@gmail.com>
# Contributor: Alexander Fehr <pizzapunk gmail com>

pkgname=('dmd-devel-common')
pkgdesc="D programming language compiler and standard library"
groups=('dlang')
_prefix='/usr'
_dlangdir="/usr/include/dlang/dmd"
pkgver=0.1.0
pkgrel=1
epoch=1
arch=('x86_64')
url="http://www.dlang.org"
source=("archlinux-dmd.d" "PKGBUILD")
sha256sums=('cf0acebc440c7357973cc394ec6bb1e99632ce2c3e01eac76a08c65b392d10e6'
	'SKIP')
makedepends=('dmd' 'libphobos-devel')
depends=('libphobos')

[[ $CARCH == "x86_64" ]] && _archbits="64"

build() {
	cp $srcdir/PKGBUILD $srcdir/PKGBUILD_copy
	dmd \
		-O -inline -unittest -m$_archbits \
		-J$srcdir/. \
		archlinux-dmd.d
}

package_dmd-devel-common() {
	pkgdesc="Common files for dmd build Environments"
	license=("CC")

	mkdir -p $pkgdir/usr/bin
	install -Dm755 $srcdir/archlinux-dmd $pkgdir/usr/bin/

	find $pkgdir -type f | xargs chmod 0644
	chmod 755 $pkgdir/usr/bin/archlinux-dmd
}
